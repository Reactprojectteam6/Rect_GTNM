{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\kieu\\\\Desktop\\\\final_project\\\\my_app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport axios from 'axios';\nconst SET_ORDER = 'SET_ORDER';\nconst GET_ORDER_HISTORY_OF_USER = 'GET_ORDER_HISTORY_OF_USER';\nconst GET_ORDER = 'GET_ORDER';\nconst GET_ORDER_DETAIL = 'GET_ORDER_DETAIL';\nexport function setOrder(order, user_id, state, address, email, phone, total_payment, payment_method, fullname) {\n  return dispatch => {\n    callApi(order, user_id, state, address, email, phone, total_payment, payment_method, fullname, error => {\n      if (!error) {\n        dispatch(setSuccess(true)); //tra ve cho form\n      } else {\n        dispatch(setSuccess(false)); //tra ve cho form\n      }\n    });\n  };\n}\n\nfunction setSuccess(isSuccess) {\n  return {\n    type: SET_ORDER,\n    isSuccess\n  };\n}\n\nasync function callApi(cart, user_id, state, address, email, phone, total_payment, payment_method, fullname, callback) {\n  console.log(order);\n  console.log(user_id);\n  console.log(state);\n  console.log(address);\n  console.log(email);\n  console.log(phone);\n  console.log(total_payment);\n  console.log(payment_method);\n  console.log(fullname);\n  var count = 0;\n  var list_shop_id = [];\n  var receiver_id = null;\n  var order_id = null;\n  list_shop_id[0] = cart[0].product.shop_id;\n\n  for (var i = 1; i < cart.length; i++) {\n    if (cart[i].product.shop_id) list_shop_id.push(cart[i].product.shop_id);\n  }\n\n  console.log(\"list_shop_id\");\n  console.log(list_shop_id);\n  console.log(\"ket thuc shop id\");\n\n  for (var i = 0; i < list_shop_id.length; i++) {\n    var shop_id = list_shop_id[i];\n    var receiver = {\n      address: address,\n      email: email,\n      fullname: fullname,\n      phone: phone\n    };\n    console.log(shop_id);\n    await axios({\n      method: 'post',\n      url: \"https://127.0.0.1:5001/api/Receiver\",\n      data: receiver,\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response => {\n      if (response.status == \"200\") receiver_id = response.data.id;\n    });\n    var total = 0;\n\n    for (var j = 0; j < cart.length; j++) {\n      if (cart[j].product.shop_id == shop_id) total += cart[j].product.price * cart[j].quantity;\n    }\n\n    var order = {\n      payment_id: payment_method,\n      receiver_id: receiver_id,\n      user_id: user_id,\n      status: Number(state),\n      total: Number(total),\n      date_create: new Date(Date.now()),\n      shop_id: shop_id\n    };\n    await axios({\n      method: 'post',\n      url: \"https://127.0.0.1:5001/api/Order\",\n      data: order,\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response1 => {\n      if (response1.status == \"200\") order_id = response1.data.id;\n    });\n\n    for (var i = 0; i < cart.length; i++) {\n      if (cart[i].quantity <= cart[i].product.quantity && cart[i].product.shop_id == shop_id) {\n        var order_detail = {\n          price: Number(cart[i].product.price),\n          product_id: cart[i].product.id,\n          quantity: Number(cart[i].quantity),\n          order_id: order_id\n        };\n        await axios({\n          method: 'post',\n          url: \"https://127.0.0.1:5001/api/OrderDetail\",\n          data: order_detail,\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'Authorization': 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(response2 => {\n          if (response2.status == \"200\") {}\n        }); //update so luong\n\n        var product = {\n          id: cart[i].product.id,\n          product_name: cart[i].product.product_name,\n          description: cart[i].product.description,\n          cat_id: cart[i].product.cat_id,\n          price: Number(cart[i].product.price),\n          quantity: cart[i].product.quantity - cart[i].quantity,\n          shop_id: cart[i].product.shop_id,\n          image: cart[i].product.image\n        };\n        var id = cart[i].product.id;\n        await axios({\n          method: 'put',\n          url: \"https://127.0.0.1:5001/api/Product/\".concat(id),\n          data: product,\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'Authorization': 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(res => {\n          if (res.status == \"200\") {\n            alert(\"order thanh cong,vui long doi de nhan hang\");\n            return callback(null);\n          } else return callback(new Error(\"loi khong tao duoc order\"));\n        });\n      }\n    }\n  }\n}\n\nexport function getOrderOfUser() {\n  return dispatch => {\n    axios({\n      method: 'get',\n      url: \"https://127.0.0.1:5001/api/Order/user/\".concat(JSON.parse(localStorage.getItem('currentUser')).id),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response => {\n      if (response.status == \"200\") {\n        dispatch({\n          type: GET_ORDER_HISTORY_OF_USER,\n          payload: response.data\n        });\n      }\n    });\n  };\n}\nexport function getOrder(id) {\n  return dispatch => {\n    axios({\n      method: 'get',\n      url: \"https://127.0.0.1:5001/api/Order/\".concat(id),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response => {\n      if (response.status == \"200\") {\n        console.log(\"ba noi m\");\n        console.log(response.data);\n        dispatch({\n          type: GET_ORDER,\n          payload: response.data\n        });\n      }\n    });\n  };\n}\nexport function getOrderDetail(id) {\n  return dispatch => {\n    axios({\n      method: 'get',\n      url: \"https://127.0.0.1:5001/api/OrderDetail/Order/\".concat(id),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response => {\n      if (response.status == \"200\") {\n        console.log(\"dcm\");\n        console.log(response.data);\n        dispatch({\n          type: GET_ORDER_DETAIL,\n          payload: response.data\n        });\n      }\n    });\n  };\n}\nvar order = JSON.parse(localStorage.getItem('order'));\nvar listOrderDetail = JSON.parse(localStorage.getItem('listOrderDetail'));\nvar order_state = {\n  isSuccess: false,\n  ordersUser: [],\n  order: order ? order : [],\n  listOrderDetail: listOrderDetail ? listOrderDetail : [] //order_user?order_user:[]\n\n};\nexport default function order_reducer(state = order_state, action) {\n  if (action.type == 'SET_ORDER') {\n    let newState = _objectSpread({}, state);\n\n    newState.isSuccess = action.isSuccess;\n    if (newState.isSuccess == true) alert(\"order thanh cong,vui long cho nhan hang\");\n    return newState;\n  }\n\n  if (action.type == 'GET_ORDER_HISTORY_OF_USER') {\n    let newState = _objectSpread({}, state);\n\n    newState.ordersUser = action.payload;\n    console.log(\"list order\");\n    console.log(newState.ordersUser); //localStorage.setItem('orderHistoryOfUser',JSON.stringify(newState.ordersUser));\n\n    return newState;\n  }\n\n  if (action.type == 'GET_ORDER') {\n    let newState = _objectSpread({}, state);\n\n    newState.order = action.payload;\n    console.log(\"order la:\");\n    console.log(newState.order);\n    localStorage.setItem('order', JSON.stringify(newState.order));\n    return newState;\n  }\n\n  if (action.type == 'GET_ORDER_DETAIL') {\n    let newState = _objectSpread({}, state);\n\n    newState.listOrderDetail = action.payload;\n    localStorage.setItem('listOrderDetail', JSON.stringify(newState.listOrderDetail));\n    return newState;\n  }\n\n  return state;\n}","map":{"version":3,"sources":["C:/Users/kieu/Desktop/final_project/my_app/src/redux/order_reducer.js"],"names":["axios","SET_ORDER","GET_ORDER_HISTORY_OF_USER","GET_ORDER","GET_ORDER_DETAIL","setOrder","order","user_id","state","address","email","phone","total_payment","payment_method","fullname","dispatch","callApi","error","setSuccess","isSuccess","type","cart","callback","console","log","count","list_shop_id","receiver_id","order_id","product","shop_id","i","length","push","receiver","method","url","data","headers","Accept","localStorage","getItem","then","response","status","id","total","j","price","quantity","payment_id","Number","date_create","Date","now","response1","order_detail","product_id","response2","product_name","description","cat_id","image","res","alert","Error","getOrderOfUser","JSON","parse","payload","getOrder","getOrderDetail","listOrderDetail","order_state","ordersUser","order_reducer","action","newState","setItem","stringify"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nconst SET_ORDER='SET_ORDER';\r\nconst GET_ORDER_HISTORY_OF_USER='GET_ORDER_HISTORY_OF_USER';\r\nconst GET_ORDER='GET_ORDER';\r\nconst GET_ORDER_DETAIL='GET_ORDER_DETAIL';\r\nexport function   setOrder(order,user_id,state,address,email,phone,total_payment,payment_method,fullname)\r\n{ return dispatch => {\r\n    callApi(order,user_id,state,address,email,phone,total_payment,payment_method,fullname,error=> {\r\n      if (!error) {\r\n        dispatch(setSuccess(true));//tra ve cho form\r\n      } else {\r\n        dispatch(setSuccess(false));//tra ve cho form\r\n      }\r\n    });\r\n  }\r\n}\r\n  function setSuccess(isSuccess) {\r\n    return {\r\n      type: SET_ORDER,\r\n      isSuccess\r\n    };\r\n  }\r\n  \r\n  async function callApi(cart,user_id,state,address,email,phone,total_payment,payment_method,fullname,callback) {\r\n    console.log(order);\r\n    console.log(user_id);\r\n    console.log(state);\r\n    console.log(address);\r\n    console.log(email);\r\n    console.log(phone);\r\n    console.log(total_payment);\r\n    console.log(payment_method);\r\n    console.log(fullname);\r\n   var count=0;\r\n  var list_shop_id=[];\r\n  var receiver_id=null;\r\n  var order_id=null;\r\n   list_shop_id[0]=cart[0].product.shop_id;\r\n    for (var i = 1; i < cart.length; i++) {\r\n     if(cart[i].product.shop_id) list_shop_id.push(cart[i].product.shop_id);\r\n\r\n      }    \r\n      console.log(\"list_shop_id\")\r\n      console.log(list_shop_id); \r\n      console.log(\"ket thuc shop id\");   \r\n    for(var i=0;i<list_shop_id.length;i++)\r\n    {  var shop_id=list_shop_id[i]; \r\n      var receiver={\r\n        address :address,\r\n        email :email,\r\n        fullname:fullname,\r\n        phone:phone\r\n      }\r\n      console.log(shop_id);\r\n    await axios(\r\n       {  method:'post',\r\n           url: `https://127.0.0.1:5001/api/Receiver`,\r\n           data:receiver,\r\n           headers:{\r\n            'Content-Type': 'application/json',\r\n            Accept: 'application/json',\r\n            'Authorization':'Bearer '+localStorage.getItem('token')\r\n          }\r\n            \r\n        }\r\n      ).then(response=>{\r\n        if(response.status==\"200\") receiver_id=response.data.id;\r\n       \r\n      \r\n      })\r\n        \r\n      var total=0;\r\n      for(var j=0;j<cart.length;j++)\r\n      { if(cart[j].product.shop_id==shop_id) total+=cart[j].product.price*cart[j].quantity;\r\n\r\n      }\r\n       var order={\r\n        payment_id:payment_method,\r\n        receiver_id :receiver_id,\r\n        user_id:user_id,\r\n        status:Number(state),\r\n        total:Number(total),\r\n        date_create:new Date(Date.now()),\r\n        shop_id:shop_id\r\n       }\r\n       await axios(\r\n        {  \r\n       method:'post',\r\n       url: `https://127.0.0.1:5001/api/Order`,\r\n       data:order,\r\n       headers:{\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'Authorization':'Bearer '+localStorage.getItem('token')\r\n      }\r\n\r\n        }\r\n      ).then(response1=>{\r\n        if(response1.status==\"200\") order_id=response1.data.id;\r\n      })\r\n      \r\n      for(var i=0;i<cart.length;i++)\r\n      { if(cart[i].quantity<=cart[i].product.quantity &&cart[i].product.shop_id==shop_id)\r\n          {  var order_detail={\r\n           price:Number(cart[i].product.price),\r\n           product_id:cart[i].product.id,\r\n           quantity:Number(cart[i].quantity),\r\n           order_id:order_id\r\n\r\n          }\r\n            await axios({\r\n             method:'post',\r\n             url: `https://127.0.0.1:5001/api/OrderDetail`,\r\n             data:order_detail,\r\n              headers:{\r\n               'Content-Type': 'application/json',\r\n               Accept: 'application/json',\r\n               'Authorization':'Bearer '+localStorage.getItem('token')\r\n             }\r\n\r\n            }).then(response2=>{\r\n              if(response2.status==\"200\")\r\n             {  \r\n                   \r\n            }\r\n           })\r\n\r\n          //update so luong\r\n\r\n          var product={\r\n\r\n            id:cart[i].product.id,\r\n            product_name:cart[i].product.product_name,\r\n            description:cart[i].product.description,\r\n            cat_id:cart[i].product.cat_id,\r\n            price:Number(cart[i].product.price),\r\n            quantity:cart[i].product.quantity-cart[i].quantity,\r\n            shop_id:cart[i].product.shop_id,\r\n            image:cart[i].product.image\r\n          }\r\n        \r\n          var id=cart[i].product.id;\r\n        await axios({\r\n          method:'put',\r\n          url: `https://127.0.0.1:5001/api/Product/${id}`,\r\n          data:product,\r\n           headers:{\r\n            'Content-Type': 'application/json',\r\n            Accept: 'application/json',\r\n            'Authorization':'Bearer '+localStorage.getItem('token')\r\n          }\r\n         }).then(res=>{\r\n          if(res.status==\"200\"){alert(\"order thanh cong,vui long doi de nhan hang\"); return callback(null)}\r\n          else return callback(new Error(\"loi khong tao duoc order\"));\r\n         })\r\n\r\n\r\n          }\r\n        }\r\n           \r\n\r\n   \r\n        \r\n    \r\n  }\r\n \r\n }\r\n \r\n export function getOrderOfUser()\r\n { \r\n  return dispatch => {\r\n    \r\n    axios(\r\n      {  method:'get',\r\n         url: `https://127.0.0.1:5001/api/Order/user/${JSON.parse(localStorage.getItem('currentUser')).id}`,\r\n         headers:{\r\n          'Content-Type': 'application/json',\r\n          Accept: 'application/json',\r\n          'Authorization':'Bearer '+localStorage.getItem('token')\r\n        }\r\n          \r\n      }\r\n    ).then(response=>{\r\n      if(response.status==\"200\")\r\n      { \r\n      dispatch({type:GET_ORDER_HISTORY_OF_USER,payload:response.data});\r\n      }\r\n     \r\n    })\r\n\r\n  };\r\n  }\r\n\r\n  export function getOrder(id)\r\n  {\r\n    return dispatch=>{\r\n\r\n      axios(\r\n        {  method:'get',\r\n           url: `https://127.0.0.1:5001/api/Order/${id}`,\r\n           headers:{\r\n            'Content-Type': 'application/json',\r\n            Accept: 'application/json',\r\n            'Authorization':'Bearer '+localStorage.getItem('token')\r\n          }\r\n            \r\n        }\r\n      ).then(response=>{\r\n        if(response.status==\"200\")\r\n        {  console.log(\"ba noi m\")\r\n           console.log(response.data);\r\n          dispatch({type:GET_ORDER,payload:response.data})\r\n        }\r\n       \r\n      })\r\n  \r\n    };\r\n    \r\n    }\r\n\r\n  export function getOrderDetail(id)\r\n  {\r\n    return dispatch => {\r\n    \r\n      axios(\r\n        {  method:'get',\r\n           url: `https://127.0.0.1:5001/api/OrderDetail/Order/${id}`,\r\n           headers:{\r\n            'Content-Type': 'application/json',\r\n            Accept: 'application/json',\r\n            'Authorization':'Bearer '+localStorage.getItem('token')\r\n          }\r\n            \r\n        }\r\n      ).then(response=>{\r\n        if(response.status==\"200\")\r\n        { console.log(\"dcm\");\r\n          console.log(response.data);\r\n        dispatch({type:GET_ORDER_DETAIL,payload:response.data});\r\n        }\r\n       \r\n      })\r\n  \r\n    };\r\n  }\r\nvar order=JSON.parse(localStorage.getItem('order'));\r\nvar listOrderDetail=JSON.parse(localStorage.getItem('listOrderDetail'))\r\nvar order_state={\r\n  isSuccess:false,\r\n  ordersUser:[],\r\n  order:order?order:[],\r\n  listOrderDetail:listOrderDetail?listOrderDetail:[]\r\n  //order_user?order_user:[]\r\n}\r\nexport default function order_reducer(state =order_state, action) {\r\n  if(action.type=='SET_ORDER')\r\n  {\r\n    let newState={...state};\r\n    newState.isSuccess=action.isSuccess;\r\n    if(newState.isSuccess==true) alert(\"order thanh cong,vui long cho nhan hang\");\r\n    return newState;\r\n  }\r\n  if(action.type=='GET_ORDER_HISTORY_OF_USER')\r\n  { let newState={...state};\r\n     newState.ordersUser=action.payload;\r\n     console.log(\"list order\");\r\n     console.log(newState.ordersUser);\r\n     //localStorage.setItem('orderHistoryOfUser',JSON.stringify(newState.ordersUser));\r\n     return newState;\r\n  }\r\n  if(action.type=='GET_ORDER')\r\n  {\r\n    let newState={...state};\r\n     newState.order=action.payload;\r\n     console.log(\"order la:\");\r\n     console.log(newState.order);\r\n    localStorage.setItem('order',JSON.stringify(newState.order));\r\n    return newState;\r\n  }\r\n  if(action.type=='GET_ORDER_DETAIL')\r\n  {let newState={...state};\r\n    newState.listOrderDetail=action.payload;\r\n    localStorage.setItem('listOrderDetail',JSON.stringify(newState.listOrderDetail));\r\n    return newState;\r\n\r\n  }\r\n      return state;\r\n  \r\n}"]},"metadata":{},"sourceType":"module"}