{"ast":null,"code":"import axios from 'axios';\nconst ADD_TO_CART = 'ADD_TO_CART';\nconst DELETE_PRODUCT_IN_CART = 'DELETE_PRODUCT_IN_CART';\nconst UPDATE_PRODUCT_IN_CART = 'UPDATE_PRODUCT_IN_CART';\nconst SET_ORDER = 'SET_ORDER';\nexport function setOrder(order, user_id, state, address, email, phone, total_payment, payment_method, fullname) {\n  return dispatch => {\n    callApi(order, user_id, state, address, email, phone, total_payment, payment_method, fullname, error => {\n      if (!error) {\n        dispatch(setSuccess()); //tra ve cho form\n      } else {\n        dispatch(setSuccess()); //tra ve cho form\n      }\n    });\n  };\n}\n\nfunction setSuccess() {\n  return {\n    type: SET_ORDER\n  };\n}\n\nfunction check(a, b) {\n  for (var i = 0; i < b.length; i++) {\n    if (a == b[i]) return true;\n  }\n\n  return false;\n}\n\nasync function callApi(cart, user_id, state, address, email, phone, total_payment, payment_method, fullname, callback) {\n  console.log(order);\n  console.log(user_id);\n  console.log(state);\n  console.log(address);\n  console.log(email);\n  console.log(phone);\n  console.log(total_payment);\n  console.log(payment_method);\n  console.log(fullname);\n  var count = 0;\n  var list_shop_id = [];\n  var receiver_id = null;\n  var order_id = null;\n  var shop_id = null;\n  var check = false;\n  list_shop_id[0] = cart[0].product.shop_id;\n\n  for (var i = 1; i < cart.length; i++) {\n    for (var k = 0; k < list_shop_id.length; k++) if (cart[i].product.shop_id != list_shop_id[k]) list_shop_id.push(cart[i].product.shop_id);\n  }\n\n  console.log(\"list_shop_id\");\n  console.log(list_shop_id);\n  console.log(\"ket thuc shop id\");\n\n  for (var i = 0; i < list_shop_id.length; i++) {\n    var receiver = {\n      address: address,\n      email: email,\n      fullname: fullname,\n      phone: phone\n    };\n    console.log(list_shop_id[i]);\n    await axios({\n      method: 'post',\n      url: \"https://127.0.0.1:5001/api/Receiver\",\n      data: receiver,\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response => {\n      if (response.status == \"200\") receiver_id = response.data.id;\n    });\n    var total = 0;\n\n    for (let j = 0; j < cart.length; j++) {\n      if (cart[j].product.shop_id == list_shop_id[i]) total += cart[j].product.price * cart[j].quantity;\n    }\n\n    var order = {\n      payment_id: payment_method,\n      receiver_id: receiver_id,\n      user_id: user_id,\n      status: Number(state),\n      total: Number(total),\n      date_create: new Date(Date.now()),\n      shop_id: list_shop_id[i]\n    };\n    await axios({\n      method: 'post',\n      url: \"https://127.0.0.1:5001/api/Order\",\n      data: order,\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization': 'Bearer ' + localStorage.getItem('token')\n      }\n    }).then(response1 => {\n      if (response1.status == \"200\") order_id = response1.data.id;\n    });\n\n    for (let j = 0; j < cart.length; j++) {\n      if (cart[j].quantity <= cart[j].product.quantity && cart[j].product.shop_id == list_shop_id[i]) {\n        let order_detail = {\n          price: Number(cart[j].product.price),\n          product_id: cart[j].product.id,\n          quantity: Number(cart[j].quantity),\n          order_id: order_id\n        };\n        await axios({\n          method: 'post',\n          url: \"https://127.0.0.1:5001/api/OrderDetail\",\n          data: order_detail,\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'Authorization': 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(response2 => {\n          if (response2.status == \"200\") {}\n        }); //update so luong\n\n        let product = {\n          id: cart[j].product.id,\n          product_name: cart[j].product.product_name,\n          description: cart[j].product.description,\n          cat_id: cart[j].product.cat_id,\n          price: Number(cart[j].product.price),\n          quantity: cart[j].product.quantity - cart[j].quantity,\n          shop_id: cart[j].product.shop_id,\n          image: cart[j].product.image\n        };\n        let id = cart[j].product.id;\n        await axios({\n          method: 'put',\n          url: \"https://127.0.0.1:5001/api/Product/\".concat(id),\n          data: product,\n          headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'Authorization': 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(res => {\n          if (res.status == \"200\") {\n            alert(\"order thanh cong,vui long doi de nhan hang\");\n            check = true;\n          } else check = false;\n        });\n      }\n    }\n  }\n\n  if (check == false) return callback(new Error(\"khong tao duoc order\"));else return callback(null);\n}\n\nexport function actAddToCart(product, quantity) {\n  return {\n    type: ADD_TO_CART,\n    product,\n    quantity\n  };\n}\nexport function actDeleteProductInCart(product) {\n  return {\n    type: DELETE_PRODUCT_IN_CART,\n    product\n  };\n}\nexport function actUpdateProductInCart(product, quantity) {\n  return {\n    type: UPDATE_PRODUCT_IN_CART,\n    product,\n    quantity\n  };\n}\nvar data = JSON.parse(localStorage.getItem('CART'));\nvar initialState = data ? data : [];\nexport default function cart_reducer(state = initialState, action) {\n  var index = -1; // Không tìm thấy => index = -1\n\n  var product = action.product,\n      quantity = action.quantity;\n\n  if (action.type == 'ADD_TO_CART') {\n    index = findProductInCart(state, product);\n\n    if (index !== -1) {\n      state[index].quantity += parseInt(quantity);\n    } else {\n      state.push({\n        product,\n        quantity\n      });\n      alert(\"add product into cart successfully\");\n    }\n\n    localStorage.setItem('CART', JSON.stringify(state));\n    return [...state];\n  }\n\n  if (action.type == 'DELETE_PRODUCT_IN_CART') {\n    index = findProductInCart(state, product);\n\n    if (index !== -1) {\n      state.splice(index, 1);\n    }\n\n    localStorage.setItem('CART', JSON.stringify(state));\n    return [...state];\n  }\n\n  if (action.type == 'UPDATE_PRODUCT_IN_CART') {\n    index = findProductInCart(state, product);\n\n    if (index !== -1) {\n      state[index].quantity = quantity;\n    }\n\n    localStorage.setItem('CART', JSON.stringify(state));\n    return [...state];\n  }\n\n  if (action.type == 'SET_ORDER') {\n    console.log(\"sdgsdfhjsdf\");\n    state.splice(0, state.length);\n    localStorage.setItem('CART', JSON.stringify(state));\n    return [...state];\n  } else return [...state];\n}\n\nvar findProductInCart = (cart, product) => {\n  //tim product da co trong cart hay chua\n  var index = -1;\n\n  if (cart.length > 0) {\n    for (var i = 0; i < cart.length; i++) {\n      if (cart[i].product.id === product.id) {\n        index = i;\n        break;\n      }\n    }\n  }\n\n  return index;\n};","map":{"version":3,"sources":["C:/Users/kieu/Desktop/final_project/my_app/src/redux/cart_reducer.js"],"names":["axios","ADD_TO_CART","DELETE_PRODUCT_IN_CART","UPDATE_PRODUCT_IN_CART","SET_ORDER","setOrder","order","user_id","state","address","email","phone","total_payment","payment_method","fullname","dispatch","callApi","error","setSuccess","type","check","a","b","i","length","cart","callback","console","log","count","list_shop_id","receiver_id","order_id","shop_id","product","k","push","receiver","method","url","data","headers","Accept","localStorage","getItem","then","response","status","id","total","j","price","quantity","payment_id","Number","date_create","Date","now","response1","order_detail","product_id","response2","product_name","description","cat_id","image","res","alert","Error","actAddToCart","actDeleteProductInCart","actUpdateProductInCart","JSON","parse","initialState","cart_reducer","action","index","findProductInCart","parseInt","setItem","stringify","splice"],"mappings":"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","sourcesContent":["import axios from 'axios';\nconst ADD_TO_CART = 'ADD_TO_CART';\nconst DELETE_PRODUCT_IN_CART = 'DELETE_PRODUCT_IN_CART';\nconst UPDATE_PRODUCT_IN_CART='UPDATE_PRODUCT_IN_CART';\nconst SET_ORDER='SET_ORDER';\nexport function   setOrder(order,user_id,state,address,email,phone,total_payment,payment_method,fullname)\n{ return dispatch => {\n    callApi(order,user_id,state,address,email,phone,total_payment,payment_method,fullname,error=> {\n      if (!error) {\n        dispatch(setSuccess());//tra ve cho form\n      } else {\n        dispatch(setSuccess());//tra ve cho form\n      }\n    });\n  }\n}\n  function setSuccess() {\n    return {\n      type: SET_ORDER,\n    };\n  }\n  function check(a,b)\n  {  for(var i=0;i<b.length;i++)\n     {\n       if(a==b[i]) return true;\n     }\n    return false;\n  }\n  async function callApi(cart,user_id,state,address,email,phone,total_payment,payment_method,fullname,callback) {\n    console.log(order);\n    console.log(user_id);\n    console.log(state);\n    console.log(address);\n    console.log(email);\n    console.log(phone);\n    console.log(total_payment);\n    console.log(payment_method);\n    console.log(fullname);\n   var count=0;\n  var list_shop_id=[];\n  var receiver_id=null;\n  var order_id=null;\n  var shop_id=null;\n  var check=false;\n   list_shop_id[0]=cart[0].product.shop_id;\n    for (var i = 1; i < cart.length; i++) {\n         for(var k=0;k<list_shop_id.length;k++)\n            if(cart[i].product.shop_id!=list_shop_id[k]) list_shop_id.push(cart[i].product.shop_id);\n\n      }    \n      console.log(\"list_shop_id\")\n      console.log(list_shop_id); \n      console.log(\"ket thuc shop id\");   \n    for(var i=0;i<list_shop_id.length;i++)\n    {  \n    \n      var receiver=\n        {\n           address :address,\n           email :email,\n           fullname:fullname,\n           phone:phone\n         }\n      console.log(list_shop_id[i]);\n    await axios(\n       {   method:'post',\n           url: `https://127.0.0.1:5001/api/Receiver`,\n           data:receiver,\n           headers:{\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n            'Authorization':'Bearer '+localStorage.getItem('token')\n          }\n            \n        }\n      ).then(response=>{\n        if(response.status==\"200\") receiver_id=response.data.id;\n       \n      \n      })\n        \n      var total=0;\n      for(let j=0;j<cart.length;j++)\n      { if(cart[j].product.shop_id==list_shop_id[i]) total+=cart[j].product.price*cart[j].quantity;\n\n      }\n       var order={\n        payment_id:payment_method,\n        receiver_id :receiver_id,\n        user_id:user_id,\n        status:Number(state),\n        total:Number(total),\n        date_create:new Date(Date.now()),\n        shop_id:list_shop_id[i]\n       }\n       await axios(\n        {  \n       method:'post',\n       url: `https://127.0.0.1:5001/api/Order`,\n       data:order,\n       headers:{\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'Authorization':'Bearer '+localStorage.getItem('token')\n      }  \n\n        }\n      ).then(response1=>{\n        if(response1.status==\"200\") order_id=response1.data.id;\n      })\n      \n      for(let j=0;j<cart.length;j++)\n      { if(cart[j].quantity<=cart[j].product.quantity &&cart[j].product.shop_id==list_shop_id[i])\n          {  let order_detail={\n           price:Number(cart[j].product.price),\n           product_id:cart[j].product.id,\n           quantity:Number(cart[j].quantity),\n           order_id:order_id\n\n          }\n            await axios({\n             method:'post',\n             url: `https://127.0.0.1:5001/api/OrderDetail`,\n             data:order_detail,\n              headers:{\n               'Content-Type': 'application/json',\n               Accept: 'application/json',\n               'Authorization':'Bearer '+localStorage.getItem('token')\n             }\n\n            }).then(response2=>{\n              if(response2.status==\"200\")\n             { \n                   \n            }\n           \n           })\n\n          //update so luong\n\n          let product={\n\n            id:cart[j].product.id,\n            product_name:cart[j].product.product_name,\n            description:cart[j].product.description,\n            cat_id:cart[j].product.cat_id,\n            price:Number(cart[j].product.price),\n            quantity:cart[j].product.quantity-cart[j].quantity,\n            shop_id:cart[j].product.shop_id,\n            image:cart[j].product.image\n          }\n        \n          let id=cart[j].product.id;\n        await axios({\n          method:'put',\n          url: `https://127.0.0.1:5001/api/Product/${id}`,\n          data:product,\n           headers:{\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'Authorization':'Bearer '+localStorage.getItem('token')\n          }\n         }).then(res=>{\n          if(res.status==\"200\"){\n              alert(\"order thanh cong,vui long doi de nhan hang\"); \n             check=true;\n            }\n            else check=false;\n           \n         })\n     \n \n\n          }\n        }  \n    \n  }\n  if(check==false)   \n  return callback(new Error(\"khong tao duoc order\"));\n      else return callback(null);\n \n } \n\nexport function  actAddToCart(product, quantity)\n {\nreturn {\n        type:ADD_TO_CART,\n        product,\n        quantity,\n    }\n}\nexport function  actDeleteProductInCart(product){\n    return {\n        type :DELETE_PRODUCT_IN_CART,\n       product    }\n}\nexport function  actUpdateProductInCart(product, quantity ){\n    return {\n        type :UPDATE_PRODUCT_IN_CART,\n       product,\n       quantity\n    }\n }\n \n var data = JSON.parse(localStorage.getItem('CART'));\nvar initialState =data ? data : [];\nexport default function cart_reducer(state =initialState, action)  {\n    var index = -1; // Không tìm thấy => index = -1\n    var {product,quantity}=action;\n    if(action.type=='ADD_TO_CART')\n    {        \n            index = findProductInCart(state, product);\n            if (index !== -1) {\n                state[index].quantity += parseInt(quantity);\n            } else {\n                state.push({\n                    product,\n                    quantity,\n                    \n                });\n                alert(\"add product into cart successfully\");\n            }\n            localStorage.setItem('CART', JSON.stringify(state));\n            return [...state];\n\n        }       \n    if(action.type=='DELETE_PRODUCT_IN_CART')\n     {\n            index = findProductInCart(state, product);\n            if (index !== -1) {\n                state.splice(index, 1);\n               \n            }\n            localStorage.setItem('CART', JSON.stringify(state));\n            return [...state];\n\n        }\n     if(action.type=='UPDATE_PRODUCT_IN_CART')\n     {\n            index = findProductInCart(state, product);\n            if(index !== -1){\n                state[index].quantity = quantity;\n            }\n            localStorage.setItem('CART', JSON.stringify(state));\n            return [...state];\n     }      \n     if(action.type=='SET_ORDER')\n     {   console.log(\"sdgsdfhjsdf\");\n         state.splice(0,state.length);\n         localStorage.setItem('CART', JSON.stringify(state));\n         return [...state];\n\n     }   \n\n\n\n     else return [...state];\n    \n}\n\nvar findProductInCart = (cart, product) => {//tim product da co trong cart hay chua\n    var index = -1;\n    if (cart.length > 0) {\n        for (var i = 0; i < cart.length; i++) {\n            if (cart[i].product.id === product.id) {\n                index = i;\n                break;\n            }\n        }\n    }\n    return index;\n}\n"]},"metadata":{},"sourceType":"module"}